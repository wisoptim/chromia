module;
import balance.*;
import auth.*;

entity user {
  key pubkey; 
  key username: text;
}

operation create_user(session_token: session_token, username: text) {
  val pubkey = validate_session(session_token);
  require(pubkey);
  require(username != "");
  var new_user = create user (pubkey, username);
  create balance (new_user, INITIAL_BALANCE); 
}

query get_user_by_username(username: text){
  return user @? {username};
}

